#!/usr/bin/env bash
# Kanata stop helper script
# Stops kanata LaunchDaemon and processes

set -e

LAUNCHD_PLIST="{{ kanata_launchd_plist }}"

echo "Stopping Kanata..."

# First, unload the LaunchDaemon to prevent auto-restart
if [ -f "$LAUNCHD_PLIST" ]; then
    echo "Unloading LaunchDaemon..."
    sudo launchctl unload "$LAUNCHD_PLIST" 2>/dev/null || true
fi

# Stop any remaining kanata processes
if pgrep -f "kanata" > /dev/null; then
    sudo pkill -f "kanata"
    sleep 1
fi

echo "âœ… Kanata stopped (LaunchDaemon unloaded)"
